<div id="spatial-catch" class="page-controller saustrap">
  <h1 class="main-title">Global fishing and distributions</h1>
  <ul id="side-menu" class="pull-right list-unstyled text-right">
    <li><method anchor="13"></method></li>
  </ul>
  <p id="main-text">
    Select one or more fishing countries below to display allocated catch data on the map.
  </p>
  <p><a ng-show="catchGraphLink" ng-href="{{catchGraphLink}}"><i class="fa fa-area-chart"></i> {{catchGraphLinkText}}</a></p>
  <p id="note"><strong>Note:</strong> The data we present ('reconstructed data') combine official reported data and reconstructed estimates of unreported data (including major discards), with reference to individual EEZs. Official reported data are <a popover="National data are used for some countries." popover-trigger="mouseenter">mainly</a> extracted from the Food and Agriculture Organization of the United Nations (FAO) <a href="http://www.fao.org/fishery/statistics/en" target="_blank">FishStat database</a>. For background information on reconstruction data, download the .pdf associated with each relevant EEZ.</p>
  <div class="sau-panel">
    <div id="query-inputs">

      <div class="row">
        <div class="col-xs-12">
          <span ng-init="showAllocationFields = true" class="expand-collapse-button" ng-click="showAllocationFields = !showAllocationFields">
            <div class="expand-collapse-icon" ng-class="{'expand-icon': !showAllocationFields, 'collapse-icon': showAllocationFields}"></div>
            <span class="expand-collapse-label">MAP TAXON ALLOCATION</span>
            <a popover="Displays where fish are caught. You can filter by several parameters to narrow your results." popover-trigger="mouseenter"><i class="info-icon fa fa-info-circle"></i></a>
          </span>
        </div>
      </div>

      <form novalidate ng-show="showAllocationFields">
        <div class="row">
          <div class="col-md-4">
            <label class="small-label" for="selectFishingCountries">Fishing countries</label>
            <selectize ng-model="query.fishingCountries" options="fishingCountries" config="{valueField: 'id', labelField: 'title', placeholder: 'Select...', sortField: 'title', searchField: ['title'], plugins: ['remove_button']}" ></selectize>
          </div>
          <div class="col-md-2">
            <div class="catches-by-query"><label class="small-label" for="selectCatchesBy">Catches by</label></div>
            <select id="selectCatchesBy" placeholder="Select" class="form-control" ng-model="query.catchesBy">
              <option value="taxa">Taxon</option>
              <option value="commercial groups">Commercial group</option>
              <option value="functional groups">Functional group</option>
            </select>
          </div>
          <div class="col-md-6">
            <div ng-show="query.catchesBy === 'taxa'">
              <div class="catches-by-query"><label class="small-label" for="selectTaxa">Taxon/taxa</label></div>
              <selectize ng-model="query.taxa" options="taxa" config="{valueField: 'taxon_key', labelField: 'displayName', placeholder: 'Select...', sortField: 'common_name', searchField: ['common_name', 'scientific_name'], plugins: ['remove_button'], maxOptions: null, render: {item: makeTaxaDropdownItem, option: makeTaxaDropdownItem}}" ></selectize>
            </div>
            <div ng-show="query.catchesBy === 'commercial groups'">
              <div class="catches-by-query"><label class="small-label" for="selectTaxa">Commercial group(s)</label></div>
              <selectize ng-model="query.commercialGroups" options="commercialGroups" config="{valueField: 'commercial_group_id', labelField: 'name', placeholder: 'Select...', sortField: 'name', searchField: ['name'], plugins: ['remove_button']}" ></selectize>
            </div>
            <div ng-show="query.catchesBy === 'functional groups'">
              <div class="catches-by-query"><label class="small-label" for="selectTaxa">Functional group(s)</label></div>
              <selectize ng-model="query.functionalGroups" options="functionalGroups" config="{valueField: 'functional_group_id', labelField: 'description', placeholder: 'Select...', sortField: 'description', searchField: ['description'], plugins: ['remove_button']}" ></selectize>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-2">
            <label class="small-label" for="selectReportingStatus">Reporting status(es)</label>
            <selectize ng-model="query.reportingStatuses" options="reportingStatuses" config="{valueField: 'id', labelField: 'name', placeholder: 'Select...', sortField: 'name', searchField: ['name'], plugins: ['remove_button']}" ></selectize>
          </div>
          <div class="col-md-2">
            <label class="small-label" for="selectCatchType">Catch type(s)</label>
            <selectize ng-model="query.catchTypes" options="catchTypes" config="{valueField: 'id', labelField: 'name', placeholder: 'Select...', sortField: 'name', searchField: ['name'], plugins: ['remove_button']}" ></selectize>
          </div>
        <div class="col-md-2">
            <label for="compareInput" class="small-label">Compare</label>
            <select id="compareInput" placeholder="Select" class="form-control" ng-model="query.comparableType" ng-options="item.name for item in comparableTypes track by item.name"></select>
          </div>
          <div class="col-md-6 timeline">
            <spatial-catch-timeline ng-model="query.year"></spatial-catch-timeline>
          </div>
          <div class="col-md-2">
            <label class="small-label">Number of buckets</label>
            <select placeholder="Select" class="form-control" ng-model="query.bucketCount" ng-options="item for item in bucketSizes"></select>
          </div>
          <div class="col-md-2">
            <label class="small-label">Bucketing method</label>
            <select placeholder="Select" class="form-control" ng-model="query.bucketingMethod" ng-options="item for item in bucketingMethods"></select>
          </div>
        </div>
      </form>
    </div>
    <div class="row" style="margin-top: -24px" toggle-hide="taxon-distribution">
      <div class="col-xs-12">
        <hr />
        <span class="expand-collapse-button" ng-click="showTaxonDistributionBar = !showTaxonDistributionBar">
          <div class="expand-collapse-icon" ng-class="{'expand-icon': !showTaxonDistributionBar, 'collapse-icon': showTaxonDistributionBar}"></div>
          <span class="expand-collapse-label">MAP TAXON DISTRIBUTION <span ng-show="!showTaxonDistributionBar && query.taxonDistribution.length > 0">({{query.taxonDistribution.length}})</span> <span class="expand-collapse-sub-label" ng-show="showTaxonDistributionBar">as of MM/DD/YYYY</span></span>
          <a popover="Displays the latest range for the selected taxon/taxa." popover-trigger="mouseenter"><i class="info-icon fa fa-info-circle"></i></a>
        </span>
      </div>
    </div>
    <div class="row" toggle-hide="taxon-distribution">
      <div class="col-md-12">
        <div ng-show="showTaxonDistributionBar" id="taxonDistributionInput"><selectize ng-model="query.taxonDistribution" options="taxa" config="{valueField: 'taxon_key', labelField: 'displayName', placeholder: 'Choose taxa', sortField: 'common_name', searchField: ['common_name', 'scientific_name'], plugins: ['remove_button'], maxOptions: null, render: {item: makeTaxaDropdownItem, option: makeTaxaDropdownItem}}" ></selectize></div>
      </div>
    </div>
    <div class="row" ng-show="isQueryValid(query) && isQueryDirty()">
      <div class="col-xs-12">
        <hr style="margin-top: 10px; margin-bottom: 4px" />
        <button id="update-map-button" type="button" class="btn btn-success btn-block" ng-click="submitQuery(query)" scroll-click="cell-map">Update map</button>
      </div>
    </div>
    <div id="spatial-catch-legend" ng-if="queryResolved">
      <div class="row">
        <div class="col-md-12 small-label">
          {{lastQuery.comparableType.name}}
          <span class="not-bold"> ({{minCatch()}} to {{maxCatch()}} t/kmÂ²)</span>
        </div>
      </div>
      <div class="row legend-row">
        <div class="col-md-3 legend-column" ng-repeat="comparee in getComparees(lastQuery)">
          <spatial-catch-legend-key key-name="getCompareeName(comparee)" key-link="getCompareeLink(comparee)" key-name-second="'(Total: ' + totalCatch(comparee) + ')'" color="getAssignedColor(comparee)" min-label="" max-label="" num-buckets="lastQuery.bucketCount || 5"></spatial-catch-legend-key>
        </div>
      </div>
      <div class="row" ng-show="lastQuery.taxonDistribution.length > 0">
        <div class="col-md-12 small-label">
          <hr class="legend-hr" />
          Taxon distribution <span class="not-bold"> (Thin to dense)</span>
        </div>
      </div>
      <div class="row legend-row" ng-show="lastQuery.taxonDistribution.length > 0">
        <div class="col-md-3 legend-column" ng-repeat="taxonId in lastQuery.taxonDistribution">
          <spatial-catch-legend-key key-name="getValueFromObjectArray(taxa, 'taxon_key', taxonId, 'displayName')" key-link="'#/taxa/' + taxonId" color="getAssignedColor('#'+taxonId)" min-label="", max-label="" num-buckets="lastQuery.bucketCount || 5"></spatial-catch-legend-key>
        </div>
      </div>
    </div>
    <div id="cell-map">
      <div id="zoom-controls">
        <a href ng-click="zoomMapIn()"><div class="zoom-in-control"></div></a>
        <a href ng-click="zoomMapOut()"><div class="zoom-out-control"></div></a>
      </div>
      <div id="cell-map-loading-overlay" ng-show="(spatialCatchData && !spatialCatchData.$resolved) || isRendering">
        <div>
          <p><i class="fa fa-spinner"></i></p>
          <p>{{loadingText}}</p>
        </div>
      </div>
    </div>
  </div>
</div>